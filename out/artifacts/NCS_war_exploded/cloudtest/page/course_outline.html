<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <title>目录导入</title>
    <link href="../css/bootstrap.min.css@v=3.3.5" rel="stylesheet">
    <link href="../css/style.min.css@v=4.0.0" rel="stylesheet">
    <script src="../lib/jquery/1.9.1/jquery.min.js"></script>
    <script src="../lib/layer/2.4/layer.js"></script>
    <script src="../js/bootstrap.min.js?v=3.3.5"></script>
    <style>
        .chA{
            font-size: 20px;
            margin-left: 5px;
            margin-bottom: 5px
        }
        .chB{
            font-size: 18px;
            margin-left: 35px;
            margin-bottom: 5px
        }
        .chC{
            font-size: 16px;
            margin-left: 67px;
            margin-bottom: 5px
        }
        .selected{
            background: grey
            
        }
    </style>
</head>
<body>
    <div style="overflow:hidden">
            <div style="position: fixed; width:20%;float: left;height: 100%;">
                    <button onclick="addChapterA()" id="buttonA" 
                    	style="width: 80px; margin-bottom: 3px; background-color:#009f95; color: #fff; border-style: none">添加章</button>
                    <br>
                    <button onclick="addChapterB()" id="buttonB" 
                    	style="width: 80px; margin-bottom: 3px; background-color:#009f95; color: #fff; border-style: none">添加节</button>
                    <br>
                    <button onclick="addChapterC()" id="buttonC"
                    	style="width: 80px; margin-bottom: 3px; background-color:#009f95; color: #fff; border-style: none">添加小节</button>
                    <br>
                    <button onclick="del()" id="button_delete"
                    	style="width: 80px; margin-bottom: 3px; background-color:#009f95; color: #fff; border-style: none">删除</button>
                    <br>
                    <button onclick="update()" id="button_edit"
                    	style="width: 80px; margin-bottom: 3px; background-color:#009f95; color: #fff; border-style: none">编辑</button>
                    <br>
                    <button onclick="clearoutline()" id="button_clear"
                    	style="width: 80px; margin-bottom: 3px; background-color:#009f95; color: #fff; border-style: none">清空</button>
                    <br>
                    <button onclick="trans()" id="button_ajax"
                    	style="width: 80px; margin-bottom: 3px; background-color:#009f95; color: #fff; border-style: none">保存</button>
             </div>
            <div style="width:80%;float:right">
                <div>
                    <div id="root">

                    </div>
                </div>
                
            </div>

       
			<div id="addchapterA" style="display:none">                
                <p> </p>
	           	<div style="margin-left:15px"> 添加章：
	           		<input type="text" style="width:300px; height:28px; font-size:18px"
	           			autocomplete="off" id="inputA">
	           	</div>
	           	<p> </p>
	            <div>
                    <button onclick="saveChA()" style=" margin-left: 266px;margin-right: 0px;
                    	 background-color:#009f95; color: #fff; border-style: none; width: 50px; height: 25px">确定</button>
                    <button onclick="cancel()" style=" background-color:#009f95; color: #fff; margin-left: 1px;
                    	 border-style: none; width: 50px; height: 25px">取消</button>
                </div>
            </div>
            <div id="addchapterB" style="display:none">                
                <p> </p>
	           	<div style="margin-left:15px"> 添加节：
	           		<input type="text" style="width:300px; height:28px; font-size:18px"
	           			autocomplete="off" id="inputB">
	           	</div>
	           	<p> </p>
	            <div>
                    <button onclick="saveChB()" style=" margin-left: 266px;margin-right: 0px;
                    	 background-color:#009f95; color: #fff; border-style: none; width: 50px; height: 25px">确定</button>
                    <button onclick="cancel()" style=" background-color:#009f95; color: #fff; margin-left: 1px;
                    	 border-style: none; width: 50px; height: 25px">取消</button>
                </div>
            </div>
            <div id="addchapterC" style="display:none">                
                <p> </p>
	           	<div style="margin-left:15px"> 添加小节：
	           		<input type="text" style="width:300px; height:28px; font-size:18px" 
	           			autocomplete="off" id="inputC">
	           	</div>
	           	<p> </p>
	            <div>
                    <button onclick="saveChC()" style=" margin-left: 279px;margin-right: 0px;
                    	 background-color:#009f95; color: #fff; border-style: none; width: 50px; height: 25px">确定</button>
                    <button onclick="cancel()" style=" background-color:#009f95; color: #fff; margin-left: 1px;
                    	 border-style: none; width: 50px; height: 25px">取消</button>
                </div>
            </div>
            <div id="del" style="display:none">
				<p></p>
				<div style="margin-left: 25px">确认删除吗？</div>
				<p></p>
				<div>
					<button onclick="delconfirm()"	style="margin-left: 115px; margin-right: 0px; background-color: #009f95;
						 color: #fff; border-style: none; width: 50px; height: 25px">确定</button>
					<button onclick="cancel()" style="background-color: #009f95; color: #fff; margin-left: 1px;
						 border-style: none; width: 50px; height: 25px">取消</button>
				</div>
		</div>
            <div id="update" style="display:none">
                <p> </p>
	           	<div style="margin-left:15px"> 更新：
	           		<input type="text" style="width:300px; height:28px; font-size:18px" 
	           			autocomplete="off" id="inputupdate">
	           	</div>
	           	<p> </p>
	            <div >
                    <button onclick="saveupdate()" style=" margin-left: 258px;margin-right: 0px;
                    	 background-color:#009f95; color: #fff; border-style: none; width: 50px; height: 25px">确定</button>
                    <button onclick="cancel()" style=" background-color:#009f95; color: #fff; margin-left: 1px;
                    	 border-style: none; width: 50px; height: 25px">取消</button>
                </div>
            </div>
            <div id="clear" style="display:none">
            	<p> </p>
            	<div  style="margin-left: 25px">确认清空吗？</div>
            	<p> </p>
                <div>
                    <button onclick="clearconfirm()" style=" margin-left: 115px;margin-right: 0px;
                    	 background-color:#009f95; color: #fff; border-style: none; width: 50px; height: 25px">确定</button>
                    <button onclick="cancel()" style=" background-color:#009f95; color: #fff; margin-left: 1px;
                    	 border-style: none; width: 50px; height: 25px">取消</button>
                </div>
            </div>
            
            <div id="savedata" style="display:none">
            	<p> </p>
            	<div  style="margin-left: 25px">编辑数据已保存，谢谢</div>
            	<p> </p>
                <div>
                    <button onclick="cancel()" style=" margin-left: 115px;margin-right: 0px;
                    	 background-color:#009f95; color: #fff; border-style: none; width: 50px; height: 25px">确定</button>
                </div>
            </div>
           


    </div>
    <script type="text/javascript">
        var chooseA,chooseB,chooseC;
        var targetA,targetB,targetC;
        var outline = [];
        var whichLayer;
        const selectA = $('#addchapterA');
        const selectB = $('#addchapterB').html();
        const selectC = $('#addchapterC').html();


        $(document).on('click','#root > div',function(){
            $('#root > div').removeClass('selected');
            $(this).addClass('selected');
            arr = $(this).attr('id').split('_');
            switch(arr.length){
                case 2:{
                    chooseA = parseInt(arr[1]);chooseB = -1; chooseC =-1;
                    break;
                }
                case 3:{
                    chooseA = parseInt(arr[1]);chooseB = parseInt(arr[2]); chooseC =-1;
                    break;
                }
                case 4:{
                    chooseA = parseInt(arr[1]);chooseB = parseInt(arr[2]); chooseC =parseInt(arr[3]);
                    break;
                }
            }
        })

        function addChapterA(){
            if($('.selected').hasClass('chB')||$('.selected').hasClass('chC')){
                layer.alert("请选中章之后再继续操作",{skin: 'layui-layer-molv'});
                return
            }else{
                if($('#root >div').hasClass('selected')){
                    targetA = chooseA+1;
                 }else{
                    targetA = outline.length
                }
            }
            
            $("#inputA").val("");
            whichLayer = layer.open({
                title :'添加',
                type: 1,
                shade: 0.5,
                shadeClose : false,
                scrollbar: false,
                skin : 'layui-layer-molv',
                area : [ '415px', '145px' ],
                content:  $('#addchapterA')
            })
        }
        
        function addChapterB(){
            if($('.selected').hasClass('chA')){
                targetA = chooseA;
                targetB = outline[chooseA].detail.length;
            }else if($('.selected').hasClass('chB')){
                targetA = chooseA;
                targetB = chooseB+1;
            }else{
                layer.alert("请选中章或节后继续操作",{skin: 'layui-layer-molv'});
                return
            }
            
            $("#inputB").val("");
            whichLayer = layer.open({
                title :'添加',
                type: 1,
                shade: 0.5,
                shadeClose : false,
                scrollbar: false,
                skin : 'layui-layer-molv',
                area : [ '415px', '145px' ],
                content:  $('#addchapterB')
            })
        }
        
        function addChapterC(){
            if($('.selected').hasClass('chB')){
                targetA = chooseA;
                targetB = chooseB;
                targetC = outline[chooseA].detail[targetB].detail.length;
            }else if($('.selected').hasClass('chC')){
                targetA = chooseA;
                targetB = chooseB;
                targetC = chooseC+1;
            }else{
                layer.alert("请选中节或小节之后继续操作",{skin: 'layui-layer-molv'});
                return
            }
            
            $("#inputC").val("");
            whichLayer = layer.open({
                title :'添加',
                type: 1,
                shade: 0.5,
                shadeClose : false,
                scrollbar: false,
                skin : 'layui-layer-molv',
                area : [ '430px', '145px' ],
                content:  $('#addchapterC')
            })
        }
        function del(){
            if(!$('#root >div').hasClass('selected')){
            	layer.alert("请先选中章或节或小节之后继续操作",{skin: 'layui-layer-molv'});
                return
            }
            whichLayer = layer.open({
                title :'删除',
                type: 1,
                shade: 0.5,
                shadeClose : false,
                scrollbar: false,
                skin: 'layui-layer-molv',
                area : [ '240px', '140px' ],
                content:  $('#del')
            })
            
        }
        function update(){
            if(!$('#root >div').hasClass('selected')){
                layer.alert("请先选中章或节或小节之后继续操作",{skin: 'layui-layer-molv'});
                return
            }
            whichLayer = layer.open({
                title :'编辑',
                type: 1,
                shade: 0.5,
                shadeClose : false,
                scrollbar: false,
                skin : 'layui-layer-molv',
                area : [ '400px', '145px' ],
                content:  $('#update')
            })
            
            var text;
          //layer.close(whichLayer);
            if(chooseC!=-1){//更新小节
                let A = outline[chooseA];
                let B = A.detail[chooseB];
                text = B.detail[chooseC];
            }else if(chooseB!=-1){//更新节
                let A = outline[chooseA];
                text = A.detail[chooseB].chapterName; 
            }else if(chooseA!=-1){//更新章
            	text = outline[chooseA].chapterName;
            }
            //console.log(text);
            $('#inputupdate').val(text);
        }
        function clearoutline(){
            whichLayer = layer.open({
                title :'信息',
                type: 1,
                shade: 0.5,
                shadeClose : false,
                scrollbar: false,
                skin: 'layui-layer-molv',
                area : [ '240px', '140px' ],
                content:  $('#clear')
            })
        }


        function clearconfirm(){
            layer.close(whichLayer)
            outline = [];
            refresh();
            layer.alert("清空成功",{skin: 'layui-layer-molv'});
        }
        function cancel(){
            layer.close(whichLayer)
        }

        function delconfirm(){
            layer.close(whichLayer)
            if(chooseC!=-1){//删除确定的小节
                let A = outline[chooseA];
                let B = A.detail[chooseB];
                B.detail.splice(chooseC,1);
            }else if(chooseB!=-1){//删除确定的节
                let A = outline[chooseA];
                A.detail.splice(chooseB,1);
            }else if(chooseA!=-1){
                outline.splice(chooseA,1);
            }
            refresh()
            layer.alert("删除成功",{skin: 'layui-layer-molv'});
        }
        function saveupdate(){
            var text = $('#inputupdate').val();
            layer.close(whichLayer);
            if(chooseC!=-1){//删除更新的小节
                let A = outline[chooseA];
                let B = A.detail[chooseB];
                B.detail[chooseC] = text;
            }else if(chooseB!=-1){//删除确定的节
                let A = outline[chooseA];
                A.detail[chooseB].chapterName = text
            }else if(chooseA!=-1){
                outline[chooseA].chapterName = text
            }

            layer.alert("编辑成功",{skin: 'layui-layer-molv'});
            refresh()
        }

        function saveChA(){
            var text = $('#inputA').val();
            layer.close(whichLayer);
            outline.splice(targetA,0,{"chapterName":text,"detail":[]})
            refresh()
        }
        function saveChB(){
            var text = $('#inputB').val();
            layer.close(whichLayer);
            thisdetail = outline[targetA].detail;
            thisdetail.splice(targetB,0,{"chapterName":text,"detail":[]})
            // outline.push({"chapterName":text,"detail":[]});
            refresh()
        }
        function saveChC(){
            var text = $('#inputC').val();
            layer.close(whichLayer);
            thisdetail = outline[targetA].detail[targetB].detail;
            thisdetail.splice(targetC,0,text);
            refresh()
        }

        function refresh(){
            let content = "";
            for(let i = 0;i<outline.length;i++){
                content = content+'<div class="chA" id="chA_'+i+'">'+"第"+(i+1)+"章&nbsp;&nbsp;"+outline[i].chapterName+'</div>'
                let a = outline[i].detail


                for(let j =0;j<a.length;j++){
                    content = content+'<div class="chB" id="chB_'+i+"_"+j+'">'+(i+1)+"."+(j+1)+"&nbsp;&nbsp;"+a[j].chapterName+'</div>'
                     let b = a[j].detail


                    for(let k = 0;k<b.length;k++){
                        content = content+'<div class="chC" id="chC_'+i+"_"+j+"_"+k+'">'+(i+1)+"."+(j+1)+"."+(k+1)+"&nbsp;&nbsp;"+b[k]+'</div>'
                    }
                }
            }

            $('#root').html(content);
            var str1 = '#chA_' + (chooseA-1)
            //console.log(str1)
            window.location.hash = str1
            var str = '#chA_' + chooseA
            //console.log(str)
            window.location.hash = str
        }
        
        function trans(){
        	parent.$('#outline_add').val(JSON.stringify(outline));
        	whichLayer = layer.open({
                title :'保存',
                type: 1,
                shade: 0.5,
                shadeClose : false,
                scrollbar: false,
                skin: 'layui-layer-molv',
                area : [ '240px', '140px' ],
                content:  $('#savedata')
            });
        }
        
        $(document).ready(function(){
        	//outline = eval ('(' + parent.$('#outline_add').val() + ')');
        	var st = parent.$('#outline_add').val();
        	outline = [];
        	if(st != "")
        		outline = $.parseJSON(st);
        	refresh();
        })
    </script>

</body>
</html>